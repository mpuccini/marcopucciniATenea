<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>enea-mongodb</title>
    <meta name="description" content="">
    <meta name="author" content=''>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/puccini/sass/researcher.min.css">

    

    
        
    
</head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "\\[", right: "\\]", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false}
            ]
        });
    });
</script>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="https://www.afs.enea.it/puccini/">
          
          marcopuccini@enea
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/puccini/about">
                        about
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/puccini/projects">
                        projects
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/puccini/publications">
                        publications
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/puccini/contacts">
                        contacts
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/puccini/docs/puccini_eurocv.pdf">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-person-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2 2a2 2 0 0 1 2-2h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm7.5 1.5v-2l3 3h-2a1 1 0 0 1-1-1zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0zm2 5.755S12 12 8 12s-5 1.755-5 1.755V14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-.245z"/></svg> resume
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<div class="container">
    <h3 id="enea-mongodb">ENEA mongoDB</h3>
<p>Among the big field of noSQL databases, <a href="https://www.mongodb.com/">mongoDB</a> is the most widely used open source technology of his type, especially for Big Data storage and mnagment. ENEA start a collaboration with me to evaluate such technology and to build up a cluster installation of the <em>Community Edition</em>. Due to the common <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP theorem</a> tradeoffs, mongoDB has a complex architecture to guarantee Consistency and (of course) Partition failures, with an high ratio of Accessibility too. This architecture consists of 3 logical entities:</p>
<ul>
<li>Shard</li>
<li>Config Server</li>
<li>Router</li>
</ul>
<p>A <strong>Shard</strong> is where data are stored and its name came from the <em>sharding</em> function that it perform. The sharding is the operation to divide data into smallest parts that being distributed to many Shards. Every part of fragmented data has an identification key, so it is possibile to rebuild the entire data once is querried. This allow the system to scale <em>horizzontally</em> that is the ability to raise performances adding more hosts (physical or virtual) instead of upgrading each single host hardware.<br>
The <strong>Config Server</strong> is the one who take all the cluster infos, such as the shards keys, the operations of data and more.<br>
The <strong>Router</strong> is the one who <em>routes</em> the traffic within the cluster, so if you need to query the DB, you <strong>must</strong> interact with him.<br>
To allow data redundancy, the shards and the config server must run on ($2n+1$) hosts each, so all the information that they have, can be replicated in a consistent way, due to the rules of <em>Consensus</em> in case of partition failures. For this reason, the minimum number of hosts that a shard and/or a Config server need to installed on is 3. This set of hosts is named <em>Replica Set</em>. So you need to build both the Shards and the Config Servers on Replica Sets. In each Replica Set there are roles:</p>
<ul>
<li>Primary: the first to receive i/o operations</li>
<li>Secondary: where data replications are copied asynchronously</li>
<li>Arbiter: partecipate on electing new Primary in case of failures, but does not hold data.</li>
</ul>
<p>The ENEA cluster is builded on 4 physical machine with this logical sheme:<br>
<img src="/imgs/sharded-cluster-arch.png?raw=true" alt=""></p>
<p>where there are 3 hosts that serves 1 Shard and 1 Config Server, and 1 hosts for the Router according to this schema for hostname roles (showed in a <em>yaml</em> way):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">cfgRS</span>:
	<span style="color:#f92672">hostnames</span>:
		- <span style="color:#ae81ff">cresco-mgdb01</span>
		- <span style="color:#ae81ff">cresco-mgdb02</span>
		- <span style="color:#ae81ff">cresco-mgdb03</span>
	<span style="color:#f92672">port</span>: <span style="color:#ae81ff">27019</span>

<span style="color:#f92672">routers</span>:
	<span style="color:#f92672">hostnames</span>:
		- <span style="color:#ae81ff">cresco-mgdb04</span>
	<span style="color:#f92672">port</span>: <span style="color:#ae81ff">27017</span>

<span style="color:#f92672">shards</span>:
	<span style="color:#f92672">hostnames</span>:
		<span style="color:#f92672">sh0</span>:
			- <span style="color:#ae81ff">cresco-mgdb03</span>
			- <span style="color:#ae81ff">cresco-mgdb02</span>
			- <span style="color:#ae81ff">cresco-mgdb01																 </span>
	<span style="color:#f92672">port</span>: <span style="color:#ae81ff">27018</span>
</code></pre></div><p>This schema shows also the ports where instances talks with. To access the mongoDB you need the proper authorizations.</p>
<blockquote>
<p>As you can see from the architecture schema, you might think it&rsquo;s useless to have only one shard. Indeed this is a Development configuration according to mongoDB manual too. This is due to the extraordinary occurrence of Covid-19 pandemic explosion concurrent to the cluster setup. So other hosts they were expected to serve the mongoDB cluster are not installed in time. <strong>Despite this, the architecture is ready at anytime to be expanded with new shards as soon is it will be possible again</strong>.</p>
</blockquote>

</div>

        </div><div id="footer" class="mb-5">
    
        <hr>
        <div class="container text-center">
            <a href="https://github.com/mpuccini/marcopucciniATenea"><small>By Marco Puccini</small></a>
        </div>
    
</div>
</body>
</html>
